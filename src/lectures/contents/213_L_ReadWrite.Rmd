```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = Sys.getenv("GRANOLARR_HOME"))
rm(list = ls())
```



# Read and write data



## Summary

Tidy-up your data

- Wide and long data
- Re-shape data
- Handle missing values

**Next**: Read and write data

- file formats
- read
- write

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
```


## Comma Separated Values

The file `2011_OAC_Raw_uVariables_Leicester.csv`
- contains data used for the 2011 Output Area Classification
- 167 variables, as well as the resulting groups
- for the city of Leicester

Extract showing only some columns

```{}
OA11CD,LSOA11CD, ... supgrpcode,supgrpname,Total_Population, ...
E00069517,E01013785, ... 6,Suburbanites,313, ...
E00169516,E01013713, ... 4,Multicultural Metropolitans,341, ...
E00169048,E01032862, ... 4,Multicultural Metropolitans,345, ...
```

The full variable names can be found in the file
- `2011_OAC_Raw_uVariables_Lookup.csv`.


## readr

Library part of the Tidyverse providing functions to read and write text files

- `readr::read_csv`: comma-separated files `.csv`
- `readr::read_csv2`: semi-colon-separated files `.csv`
- `readr::read_tsv`: tab-separated files `.tsv`
- `readr::read_fwf`: fix-width files `.fwf`
- `readr::read_delim`: files using a custom delimiter

and their *write* counterpart, such as

- `readr::write_csv`: comma-separated files `.csv`


## Read

The `readr::read_csv` function of the [`readr`](https://readr.tidyverse.org/index.html) library reads a *csv* file from the path provided as the first argument


```{r, echo=TRUE, eval=FALSE}
leicester_2011OAC <- readr::read_csv("2011_OAC_Raw_uVariables_Leicester.csv")

leicester_2011OAC %>% 
  dplyr::select(OA11CD,LSOA11CD, supgrpcode,supgrpname,Total_Population)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
leicester_2011OAC <- readr::read_csv(paste0(Sys.getenv("GRANOLARR_HOME"), "/data/", "2011_OAC_Raw_uVariables_Leicester.csv"))
leicester_2011OAC %>% 
  dplyr::select(OA11CD,LSOA11CD, supgrpcode,supgrpname,Total_Population) %>%
  dplyr::slice_head(n = 3) %>%
  knitr::kable()
```



## Read options

Read functions provide options about how to interpret a file contents

- For instance, `readr::read_csv`
  - `col_names`: 
    - `TRUE` or `FALSE` whether top row is column names
    - or a vector of column names
  - `col_types`:
    - a `cols()` specification or a string
  - `skip`: lines to skip before reading data
  - `n_max`: max number of record to read



## Read options

```{r, echo=TRUE, eval=FALSE}
readr::read_csv("2011_OAC_Raw_uVariables_Leicester.csv")
```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
readr::read_csv(paste0(Sys.getenv("GRANOLARR_HOME"), "/data/", "2011_OAC_Raw_uVariables_Leicester.csv")) %>%
  print(n = 3)
```


```{r, echo=TRUE, eval=FALSE}
readr::read_csv(
  "2011_OAC_Raw_uVariables_Leicester.csv"
  )
```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
readr::read_csv(paste0(Sys.getenv("GRANOLARR_HOME"), "/data/", "2011_OAC_Raw_uVariables_Leicester.csv")) %>%
  print(n = 3)
```

## Write

The function `write_csv` can be used to save a dataset to `csv`

Example:

1. **read** the 2011 OAC dataset
2. **select** a few columns
3. **filter** only those OA in the supergroup *Suburbanites* (code `6`)
4. **write** the results to a file named *Leicester_Suburbanites.csv* in your home folder

```{r, echo=TRUE, eval=FALSE}
readr::read_csv("2011_OAC_Raw_uVariables_Leicester.csv") %>%
  dplyr::select(OA11CD, supgrpcode, supgrpname) %>%
  dplyr::filter(supgrpcode == 6) %>%
  readr::write_csv("~/Leicester_Suburbanites.csv")
```


## Other data imports

[Tidyverse](https://www.tidyverse.org/) also imports [other packages for reading data](https://www.tidyverse.org/packages/#import)

- Tabular formats
  - [`readxl`](https://readxl.tidyverse.org/) for Excel (`.xls` and `.xlsx`)
  - [`haven`](https://haven.tidyverse.org/) for SPSS, Stata, and SAS data.
- Databases
  - [`DBI`](https://cran.r-project.org/web/packages/DBI/) for relational databases
  - Specific backends require different packages, e.g. [`RPostgreSQL`](https://cran.r-project.org/web/packages/RPostgreSQL/)
- NoSQL
  - [`jsonlite`](https://cran.r-project.org/web/packages/jsonlite/) for JSON
  - [`xml2`](https://cran.r-project.org/web/packages/xml2/) for XML
- Web
  - [`httr`](https://cran.r-project.org/web/packages/httr/) for web APIs.
  - [`rvest`](https://cran.r-project.org/web/packages/rvest/) for web scraping.








## Summary

Read and write data

- file formats
- read
- write

**Next**: Practical session

- Read and write data
- Tidy data
- Join operations

```{r cleanup, include=FALSE}
rm(list = ls())
```